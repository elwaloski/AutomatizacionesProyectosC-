IF OBJECT_ID('[DBO].[QA_01_EXISTE_EMPR_HOLD]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_EXISTE_EMPR_HOLD]')
END
GO

CREATE PROCEDURE [DBO].[QA_01_EXISTE_EMPR_HOLD]
@CODI_EMEX VARCHAR(10),
@CODI_EMPR INT
AS
BEGIN
    IF EXISTS (SELECT CODI_EMPR FROM EMPR_HOLD WHERE CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR)
    BEGIN
        SELECT '1' AS EXISTE
    END
    ELSE
    BEGIN
        SELECT -1 AS EXISTE
    END
END
GO

IF OBJECT_ID('[DBO].[QA_01_ELIMINA_PARA_EMPR_HOLD]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_ELIMINA_PARA_EMPR_HOLD]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_ELIMINA_PARA_EMPR_HOLD]
@CODI_EMEX VARCHAR(10),
@CODI_PAEM VARCHAR(10),
@CODI_EMPR INT
AS
BEGIN
    IF  EXISTS (SELECT * FROM PARA_EMPR_HOLD WHERE CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR AND CODI_PAEM = @CODI_PAEM )
    BEGIN
        DELETE PARA_EMPR_HOLD WHERE CODI_PAEM=@CODI_PAEM  AND CODI_EMEX=@CODI_EMEX AND CODI_EMPR=@CODI_EMPR
        SELECT 1 'ELIMINADO'
    END
    ELSE
    BEGIN
        SELECT -1 'ELIMINADO'
    END
END
GO

IF OBJECT_ID('[DBO].[QA_01_ACTUALIZA_PARA_EMPR_HOLD]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_ACTUALIZA_PARA_EMPR_HOLD]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_ACTUALIZA_PARA_EMPR_HOLD]
@CODI_EMEX VARCHAR(10),
@CODI_PAEM VARCHAR(10),
@CODI_EMPR INT,
@VALO_PAEM VARCHAR(10)
AS
BEGIN
    IF EXISTS (SELECT * FROM PARA_EMPR_HOLD WHERE CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR AND CODI_PAEM = @CODI_PAEM)
    BEGIN
        UPDATE PARA_EMPR_HOLD SET VALO_PAEM = @VALO_PAEM WHERE CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR AND CODI_PAEM = @CODI_PAEM
        SELECT 1 'VERIFICAR LOS DATOS INGRESADOS'
    END
    ELSE
    BEGIN
        SELECT -1 'VERIFICAR LOS DATOS INGRESADOS'
    END
END
GO

IF OBJECT_ID('[DBO].[QA_01_INSERTA_PARA_EMPR_HOLD]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_INSERTA_PARA_EMPR_HOLD]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_INSERTA_PARA_EMPR_HOLD]
@CODI_EMEX VARCHAR(10),
@CODI_PAEM VARCHAR(10),
@CODI_EMPR INT,
@VALO_PAEM VARCHAR(10),
@TIPO_COMO VARCHAR(10),
@DESC_PAEM VARCHAR(10),
@OBLI_PAEM VARCHAR(10)

AS
BEGIN
    IF NOT EXISTS (SELECT * FROM PARA_EMPR_HOLD WHERE CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR AND CODI_PAEM = @CODI_PAEM AND VALO_PAEM=@VALO_PAEM)
    BEGIN
        INSERT INTO  PARA_EMPR_HOLD (CODI_EMEX,CODI_EMPR,CODI_PAEM,TIPO_COMO,DESC_PAEM,VALO_PAEM,OBLI_PAEM) VALUES (@CODI_EMEX,@CODI_EMPR,@CODI_PAEM,@TIPO_COMO ,@DESC_PAEM,@VALO_PAEM ,@OBLI_PAEM)
        SELECT 1 'REGISTRADO'
    END
    ELSE
    BEGIN
        SELECT -1 'REGISTRADO'
    END
END
GO

IF OBJECT_ID('[DBO].[QA_01_SELECT_1_EXISTE_PARA_EMPR_HOLD]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_SELECT_1_EXISTE_PARA_EMPR_HOLD]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_SELECT_1_EXISTE_PARA_EMPR_HOLD]
@CODI_EMEX VARCHAR(10)

AS
BEGIN
    IF  EXISTS (SELECT * FROM PARA_EMPR_HOLD WHERE CODI_EMEX = @CODI_EMEX )
    BEGIN
        SELECT TOP 1  CODI_EMEX FROM PARA_EMPR_HOLD WHERE CODI_EMEX = @CODI_EMEX 
        SELECT 1 'EXISTE'
    END
    ELSE
    BEGIN
        SELECT -1 'EXISTE'
    END
END
GO

IF OBJECT_ID('[DBO].[QA_01_SELECT_BEL_ENCA_DOCU_HOLD]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_SELECT_BEL_ENCA_DOCU_HOLD]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_SELECT_BEL_ENCA_DOCU_HOLD]


AS
BEGIN
		SELECT *FROM BEL_ENCA_DOCU_HOLD 
        SELECT '1' 'EXISTE'

END
GO

IF OBJECT_ID('[DBO].[QA_01_SELECT_BEL_ENCA_DOCU_HOLD_PARAM]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_SELECT_BEL_ENCA_DOCU_HOLD_PARAM]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_SELECT_BEL_ENCA_DOCU_HOLD_PARAM]
@CODI_EMEX VARCHAR(10),
@TIPO_DOCU INT,
@FOLI_DOCU INT,
@CODI_EMPR INT

AS
BEGIN
		SELECT *FROM BEL_ENCA_DOCU_HOLD WHERE CODI_EMEX=@CODI_EMEX AND TIPO_DOCU=@TIPO_DOCU AND FOLI_DOCU=@FOLI_DOCU AND CODI_EMPR=@CODI_EMPR
        SELECT '1' 'EXISTE'

END
GO

IF OBJECT_ID('[DBO].[QA_01_SELECT_DTE_ENCA_DOCU_HOLD]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_SELECT_DTE_ENCA_DOCU_HOLD]')
END
GO

CREATE PROCEDURE [DBO].[QA_01_SELECT_DTE_ENCA_DOCU_HOLD]

AS
BEGIN
        SELECT * FROM DTE_ENCA_DOCU_HOLD 
        SELECT '1' 'EXISTE'

END
GO

IF OBJECT_ID('[DBO].[QA_01_SELECT_DTE_ENCA_DOCU_HOLD_PARAM]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_SELECT_DTE_ENCA_DOCU_HOLD_PARAM]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_SELECT_DTE_ENCA_DOCU_HOLD_PARAM]
@CODI_EMEX VARCHAR(10),
@TIPO_DOCU INT,
@FOLI_DOCU INT,
@CODI_EMPR INT

AS
BEGIN
		SELECT *FROM DTE_ENCA_DOCU_HOLD WHERE CODI_EMEX=@CODI_EMEX AND TIPO_DOCU=@TIPO_DOCU AND FOLI_DOCU=@FOLI_DOCU AND CODI_EMPR=@CODI_EMPR
        SELECT '1' 'EXISTE'

END
GO

IF OBJECT_ID('[DBO].[QA_01_SELECT_EXISTE_PARA_EMPR_HOLD]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_SELECT_EXISTE_PARA_EMPR_HOLD]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_SELECT_EXISTE_PARA_EMPR_HOLD]
@CODI_EMEX VARCHAR(10),
@CODI_PAEM VARCHAR(10),
@CODI_EMPR INT
AS
BEGIN
    IF  EXISTS (SELECT * FROM PARA_EMPR_HOLD WHERE CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR AND CODI_PAEM = @CODI_PAEM )
    BEGIN
        SELECT TOP 1  CODI_EMEX FROM PARA_EMPR_HOLD WHERE CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR AND CODI_PAEM = @CODI_PAEM
        SELECT '1' 'EXISTE'
    END
    ELSE
    BEGIN
        SELECT '-1' 'EXISTE'
    END
END
GO

IF OBJECT_ID('[DBO].[QA_01_SELECT_PARA_EMPR]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_SELECT_PARA_EMPR]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_SELECT_PARA_EMPR]
AS
BEGIN
    SELECT * FROM PARA_EMPR_HOLD;
END
GO

IF OBJECT_ID('[DBO].[QA_01_SELECT_PARA_EMPR_CODI_PAEM_HOLD]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_SELECT_PARA_EMPR_CODI_PAEM_HOLD]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_SELECT_PARA_EMPR_CODI_PAEM_HOLD]
@CODI_EMEX VARCHAR(10),
@CODI_PAEM VARCHAR(10),
@CODI_EMPR INT
AS
BEGIN
    SELECT * FROM PARA_EMPR_HOLD WHERE CODI_EMEX=@CODI_EMEX AND CODI_PAEM=@CODI_PAEM AND CODI_EMPR=@CODI_EMPR;
END

GO
IF OBJECT_ID('[DBO].[QA_01_OBTENERFOLIODISPONIBLEBOLETAS]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_OBTENERFOLIODISPONIBLEBOLETAS]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_OBTENERFOLIODISPONIBLEBOLETAS]
    @TIPO_DOCU INT,
    @CODI_EMEX VARCHAR(10),
    @CODI_EMPR INT
AS
BEGIN
SELECT
CASE
            WHEN(SELECT ISNULL(MAX(FOLI_DOCU), 0)  FROM BEL_ENCA_DOCU_HOLD WHERE TIPO_DOCU = @TIPO_DOCU AND CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR) = ISNULL(MAX(FOLI_HAST), -1) THEN -1 
            WHEN ISNULL(MAX(FOLI_HAST),0) = 0 THEN -2
            ELSE (SELECT ISNULL(MAX(FOLI_DOCU), 0) + 1 FROM BEL_ENCA_DOCU_HOLD WHERE TIPO_DOCU = @TIPO_DOCU AND CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR) 
        END AS FOLIO_DISPONIBLE 
    FROM DTE_RANG_FOLI_HOLD 
    WHERE CODI_EMEX = @CODI_EMEX AND TIPO_DORA = @TIPO_DOCU AND CODI_EMPR = @CODI_EMPR AND ESTA_RAFO = 'VAL' 
END
GO

GO
IF OBJECT_ID('[DBO].[QA_01_OBTENERFOLIODISPONIBLEFACTURAS]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_OBTENERFOLIODISPONIBLEFACTURAS]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_OBTENERFOLIODISPONIBLEFACTURAS]
    @TIPO_DOCU INT,
    @CODI_EMEX VARCHAR(10),
    @CODI_EMPR INT
AS
BEGIN
    SELECT 
        CASE 
            WHEN(SELECT ISNULL(MAX(FOLI_DOCU), 0)  FROM DTE_ENCA_DOCU_HOLD WHERE TIPO_DOCU = @TIPO_DOCU AND CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR) = ISNULL(MAX(FOLI_HAST), -1) THEN -1 
            WHEN ISNULL(MAX(FOLI_HAST),0) = 0 THEN -2
            ELSE (SELECT ISNULL(MAX(FOLI_DOCU), 0) + 1 FROM DTE_ENCA_DOCU_HOLD WHERE TIPO_DOCU = @TIPO_DOCU AND CODI_EMEX = @CODI_EMEX AND CODI_EMPR = @CODI_EMPR) 
        END AS FOLIO_DISPONIBLE 
    FROM DTE_RANG_FOLI_HOLD 
    WHERE CODI_EMEX = @CODI_EMEX AND TIPO_DORA = @TIPO_DOCU AND CODI_EMPR = @CODI_EMPR AND ESTA_RAFO = 'VAL' 
END
GO

GO
IF OBJECT_ID('[DBO].[QA_01_PRC_DTE_RANG_FOLI_HOLD_VAL]') IS NOT NULL
BEGIN
    EXEC('DROP PROCEDURE [DBO].[QA_01_PRC_DTE_RANG_FOLI_HOLD_VAL]')
END
GO
CREATE PROCEDURE [DBO].[QA_01_PRC_DTE_RANG_FOLI_HOLD_VAL]
AS
BEGIN
   SELECT * FROM DTE_RANG_FOLI_HOLD WHERE ESTA_RAFO='VAL'
END
GO